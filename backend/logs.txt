Optimized Route] POST /call-status-optimized - 200 - 2ms
=== OPTIMIZED MAKE CALL REQUEST ===
Timestamp: 2025-08-29T18:38:57.520Z
Request body keys: [
  'to',
  'from',
  'workflowId',
  'nodes',
  'edges',
  'globalPrompt',
  'config',
  'record',
  'timeout',
  'twilioAccountSid',
  'twilioAuthToken'
]
[PredictiveCache] Initialized with config: { maxCacheSize: 10000, maxAge: 86400000, semanticThreshold: 0.85 }
[LanguageOptimizer] Initialized with support for 53 languages
[LanguageOptimizer] Cantonese specialization enabled
[StreamingAudioProcessor] Initialized with config: {
  sampleRate: 8000,
  audioFormat: 'mulaw',
  streamingMode: 'bidirectional',
  optimizations: {
    noiseReduction: true,
    echoCancellation: true,
    voiceActivityDetection: true
  }
}
[StreamingAudioProcessor] Initialized with config: {
  sampleRate: 8000,
  audioFormat: 'mulaw',
  streamingMode: 'bidirectional',
  optimizations: {
    noiseReduction: true,
    echoCancellation: true,
    voiceActivityDetection: true
  }
}
[ConversationRelay] Initialized with bidirectional streaming
[PerformanceOrchestrator] Initialized with all optimizations enabled
[PerformanceOrchestrator] Starting optimized conversation for call call_1756492737521_uh9pp9y1g
[ConversationRelay] Starting conversation for call call_1756492737521_uh9pp9y1g
[ConversationRelay] Workflow data: {
  workflowId: 'workflow-1756492736537',
  nodesCount: 12,
  edgesCount: 16,
  hasGlobalPrompt: true
}
[ConversationRelay] WebSocket connection setup for call call_1756492737521_uh9pp9y1g (using TwiML bridge)
[ConversationRelay] Audio pipeline configured
[ConversationRelay] Stream initialized for call call_1756492737521_uh9pp9y1g
[ConversationRelay] Bidirectional streaming setup complete for call call_1756492737521_uh9pp9y1g
[ConversationRelay] Conversation started in 0.21866700000828132ms
[PerformanceOrchestrator] Optimized conversation started in 0.2776210000156425ms
Performance optimization initialized: {
  success: true,
  callSid: 'call_1756492737521_uh9pp9y1g',
  optimizations: {
    conversationRelay: true,
    predictiveCache: true,
    languageOptimization: true,
    providerFailover: true
  },
  expectedLatency: '150-250ms'
}
Using optimized TwiML endpoint: https://kimiyi-ai.onrender.com/api/twiml-optimized?id=workflow-1756492736537&trackingId=call_1756492737521_uh9pp9y1g
Optimized Twilio API call parameters: {
  To: '+919649770017',
  From: '+17077433838',
  Url: 'https://kimiyi-ai.onrender.com/api/twiml-optimized?id=workflow-1756492736537&trackingId=call_1756492737521_uh9pp9y1g',
  OptimizationEnabled: true,
  ExpectedLatency: '150-250ms',
  TrackingId: 'call_1756492737521_uh9pp9y1g'
}
Twilio call created successfully: {
  callSid: 'CA79589809a8e7974591354ac6e76f8ff0',
  status: 'queued',
  to: '+919649770017',
  from: '+17077433838',
  optimizationEnabled: true,
  trackingId: 'call_1756492737521_uh9pp9y1g'
}
[TwiML-Optimized] ===== FAST TWIML REQUEST =====
[TwiML-Optimized] Call: CA79589809a8e7974591354ac6e76f8ff0, Workflow: workflow-1756492736537, Tracking: call_1756492737521_uh9pp9y1g
[generateFastTwiML] ===== CREATING TWIML =====
[generateFastTwiML] Workflow: workflow-1756492736537, Tracking: call_1756492737521_uh9pp9y1g
[generateFastTwiML] WebSocket URL: wss://kimiyi-ai.onrender.com/api/conversationrelay-ws?workflowId=workflow-1756492736537&trackingId=call_1756492737521_uh9pp9y1g
[generateFastTwiML] ===== TWIML GENERATED =====
[generateFastTwiML] TwiML length: 435 chars
[generateFastTwiML] WebSocket URL encoded: wss://kimiyi-ai.onrender.com/api/conversationrelay-ws?workflowId=workflow-1756492736537&amp;trackingId=call_1756492737521_uh9pp9y1g
[generateFastTwiML] ACTUAL TWIML CONTENT:
<?xml version="1.0" encoding="UTF-8"?>
<Response>
    <Connect>
        <ConversationRelay
            url="wss://kimiyi-ai.onrender.com/api/conversationrelay-ws?workflowId=workflow-1756492736537&amp;trackingId=call_1756492737521_uh9pp9y1g"
            welcomeGreeting="Hello Aditya! I'm your Kimiya. How can I help you today?"
            voice="21m00Tcm4TlvDq8ikWAM"
            language="en-US"
        />
    </Connect>
</Response>
[TwiML-Optimized] FAST TwiML generated in 0.18ms
[TwiML-Optimized] Background orchestrator ready for call_1756492737521_uh9pp9y1g
[ConversationRelay-WS] üîç Verifying WebSocket client connection
[ConversationRelay-WS] üîç Origin: undefined
[ConversationRelay-WS] üîç URL: /api/conversationrelay-ws?workflowId=workflow-1756492736537&trackingId=call_1756492737521_uh9pp9y1g
[ConversationRelay-WS] üîç User-Agent: Jetty/11.0.20
[ConversationRelay-WS] üîç Sec-WebSocket-Protocol: undefined
[ConversationRelay-WS] ‚úÖ Detected Twilio ConversationRelay connection attempt
[ConversationRelay-WS] üéâ ===== NEW WEBSOCKET CONNECTION ESTABLISHED =====
[ConversationRelay-WS] üîó Request URL: /api/conversationrelay-ws?workflowId=workflow-1756492736537&trackingId=call_1756492737521_uh9pp9y1g
[ConversationRelay-WS] üîó Request method: GET
[ConversationRelay-WS] üîó Connection time: 2025-08-29T18:39:05.434Z
[ConversationRelay-WS] üîó Remote address: ::1
[ConversationRelay-WS] üîó User-Agent: Jetty/11.0.20
[ConversationRelay-WS] üîó Protocol: 
[ConversationRelay-WS] ===== CONNECTION PARAMETERS =====
[ConversationRelay-WS] CallSid: call_1756492745434
[ConversationRelay-WS] TrackingId: call_1756492737521_uh9pp9y1g
[ConversationRelay-WS] WorkflowId: workflow-1756492736537
[ConversationRelay-WS] All URL params: {
  workflowId: 'workflow-1756492736537',
  trackingId: 'call_1756492737521_uh9pp9y1g'
}
[ConversationRelay-WS] ===== REQUEST HEADERS =====
[ConversationRelay-WS] User-Agent: Jetty/11.0.20
[ConversationRelay-WS] Origin: undefined
[ConversationRelay-WS] Protocol: undefined
[ConversationRelay-WS] Host: kimiyi-ai.onrender.com
[ConversationRelay-WS] All headers: {
  host: 'kimiyi-ai.onrender.com',
  'user-agent': 'Jetty/11.0.20',
  'accept-encoding': 'gzip, br',
  'cache-control': 'no-cache',
  'cdn-loop': 'cloudflare; loops=1',
  'cf-connecting-ip': '52.207.243.62',
  'cf-ipcountry': 'US',
  'cf-ray': '976e2b4989e53afc-IAD',
  'cf-visitor': '{"scheme":"https"}',
  connection: 'Upgrade',
  pragma: 'no-cache',
  'render-cf-start-time-msec': '203',
  'render-cf-start-time-sec': '1756492745',
  'render-proxy-ttl': '4',
  'rndr-id': 'a256890c-9c4b-462c',
  'sec-websocket-key': '3NqSvIsH2OokEeT8ok2tNQ==',
  'sec-websocket-version': '13',
  'true-client-ip': '52.207.243.62',
  upgrade: 'websocket',
  'x-forwarded-for': '52.207.243.62, 10.220.9.194',
  'x-forwarded-proto': 'https',
  'x-render-as-num': '14618',
  'x-render-threat-score': '0',
  'x-twilio-signature': 'JC7WKfF6I6vmdrGmMxWfrhwSP6o='
}
[ConversationRelay-WS] üïê Started silence timeout for call_1756492745434 (30000ms)
[ConversationRelay-WS] ‚úÖ ConversationRelay session ready for call_1756492745434 - waiting for setup message
[ConversationRelay-WS] ===== MESSAGE RECEIVED =====
[ConversationRelay-WS] CallSid: call_1756492745434
[ConversationRelay-WS] Event: undefined
[ConversationRelay-WS] Message count: 1
[ConversationRelay-WS] Message size: 353 bytes
[ConversationRelay-WS] Timestamp: 2025-08-29T18:39:05.524Z
[ConversationRelay-WS] Session active: false
[ConversationRelay-WS] Full message structure: [
  'type',             'sessionId',
  'callSid',          'parentCallSid',
  'from',             'to',
  'forwardedFrom',    'callerName',
  'direction',        'callType',
  'callStatus',       'accountSid',
  'customParameters'
]
[ConversationRelay-WS] Message preview: {"type":"setup","sessionId":"VXd677fbb9af006811d1e745f63f62f000","callSid":"CA79589809a8e7974591354ac6e76f8ff0","parentCallSid":"","from":"+17077433838","to":"+919649770017","forwardedFrom":"","caller...
[ConversationRelay-WS] üîß Handling SETUP message - ConversationRelay initialization
[ConversationRelay-WS] üîß SETUP message received for call_1756492745434
[ConversationRelay-WS] Setup details: {
  "type": "setup",
  "sessionId": "VXd677fbb9af006811d1e745f63f62f000",
  "callSid": "CA79589809a8e7974591354ac6e76f8ff0",
  "parentCallSid": "",
  "from": "+17077433838",
  "to": "+919649770017",
  "forwardedFrom": "",
  "callerName": "",
  "direction": "outbound-api",
  "callType": "PSTN",
  "callStatus": "IN_PROGRESS",
  "accountSid": "AC64208c7087a03b475ea7fa9337b692f8",
  "customParameters": {}
}
[ConversationRelay-WS] ‚úÖ Setup complete, waiting for user input for call_1756492745434
[ConversationRelay-WS] TwiML welcomeGreeting will handle initial greeting automatically
[ConversationRelay-WS] üí¨ Sending follow-up prompt to encourage user interaction
[ConversationRelay-WS] üì§ Sending text message to call_1756492745434: "How can I help you today?"
[ConversationRelay-WS] üì§ Sending text message with ElevenLabs voice config
[ConversationRelay-WS] üìã Full message being sent: {
  "type": "text",
  "text": "How can I help you today?",
  "voice": {
    "name": "21m00Tcm4TlvDq8ikWAM",
    "language": "en-US"
  }
}
[ConversationRelay-WS] üîÑ Attempting to send message via WebSocket
[ConversationRelay-WS] WebSocket state: 1 (1=OPEN, 2=CLOSING, 3=CLOSED)
[ConversationRelay-WS] üì° Sending to Twilio ConversationRelay: {"type":"text","text":"How can I help you today?","voice":{"name":"21m00Tcm4TlvDq8ikWAM","language":"en-US"}}
[ConversationRelay-WS] ‚úÖ Message sent successfully to ConversationRelay
[ConversationRelay-WS] ‚úÖ Text message sent successfully to call_1756492745434
[ConversationRelay-WS] ===== MESSAGE RECEIVED =====
[ConversationRelay-WS] CallSid: call_1756492745434
[ConversationRelay-WS] Event: undefined
[ConversationRelay-WS] Message count: 2
[ConversationRelay-WS] Message size: 84 bytes
[ConversationRelay-WS] Timestamp: 2025-08-29T18:39:19.652Z
[ConversationRelay-WS] Session active: true
[ConversationRelay-WS] Full message structure: [ 'type', 'voicePrompt', 'lang', 'last' ]
[ConversationRelay-WS] Message preview: {"type":"prompt","voicePrompt":"Hello, can you hear me?","lang":"en-US","last":true}...
[ConversationRelay-WS] üé§ Handling PROMPT message - User speech transcription
[ConversationRelay-WS] üé§ PROMPT message received for call_1756492745434
[ConversationRelay-WS] User speech: Hello, can you hear me?
[ConversationRelay-WS] üïê Started silence timeout for call_1756492745434 (30000ms)
[ConversationRelay-WS] üîÑ Reset silence timeout for call_1756492745434
[ConversationRelay-WS] Processing speech transcript: "Hello, can you hear me?"
[ConversationRelay-WS] No ConversationRelay service for call_1756492745434, using basic processing
[ConversationRelay-WS] Processing transcript fallback: "Hello, can you hear me?"
[ConversationRelay-WS] Calling Azure OpenAI with 2 messages
[ConversationRelay-WS] Azure OpenAI response: Hi there! Yes, I can hear you. How can I help you today?...
[ConversationRelay-WS] ===== SENDING AI RESPONSE =====
[ConversationRelay-WS] CallSid: call_1756492745434
[ConversationRelay-WS] Response text: "Hi there! Yes, I can hear you. How can I help you today?"
[ConversationRelay-WS] WebSocket state: 1
[ConversationRelay-WS] Session active: true
[ConversationRelay-WS] Added to conversation history. Total messages: 1
[ConversationRelay-WS] üì§ Sending text message to call_1756492745434: "Hi there! Yes, I can hear you. How can I help you today?"
[ConversationRelay-WS] üì§ Sending text message with ElevenLabs voice config
[ConversationRelay-WS] üìã Full message being sent: {
  "type": "text",
  "text": "Hi there! Yes, I can hear you. How can I help you today?",
  "voice": {
    "name": "21m00Tcm4TlvDq8ikWAM",
    "language": "en-US"
  }
}
[ConversationRelay-WS] üîÑ Attempting to send message via WebSocket
[ConversationRelay-WS] WebSocket state: 1 (1=OPEN, 2=CLOSING, 3=CLOSED)
[ConversationRelay-WS] üì° Sending to Twilio ConversationRelay: {"type":"text","text":"Hi there! Yes, I can hear you. How can I help you today?","voice":{"name":"21m00Tcm4TlvDq8ikWAM","language":"en-US"}}
[ConversationRelay-WS] ‚úÖ Message sent successfully to ConversationRelay
[ConversationRelay-WS] ‚úÖ Text message sent successfully to call_1756492745434
[ConversationRelay-WS] ‚úÖ AI response sent successfully to call_1756492745434
[ConversationRelay-WS] Response preview: "Hi there! Yes, I can hear you. How can I help you today?..."
[ConversationRelay-WS] ===== MESSAGE RECEIVED =====
[ConversationRelay-WS] CallSid: call_1756492745434
[ConversationRelay-WS] Event: undefined
[ConversationRelay-WS] Message count: 3
[ConversationRelay-WS] Message size: 82 bytes
[ConversationRelay-WS] Timestamp: 2025-08-29T18:39:30.856Z
[ConversationRelay-WS] Session active: true
[ConversationRelay-WS] Full message structure: [ 'type', 'voicePrompt', 'lang', 'last' ]
[ConversationRelay-WS] Message preview: {"type":"prompt","voicePrompt":" You are not Audible.","lang":"en-US","last":true}...
[ConversationRelay-WS] üé§ Handling PROMPT message - User speech transcription
[ConversationRelay-WS] üé§ PROMPT message received for call_1756492745434
[ConversationRelay-WS] User speech:  You are not Audible.
[ConversationRelay-WS] üïê Started silence timeout for call_1756492745434 (30000ms)
[ConversationRelay-WS] üîÑ Reset silence timeout for call_1756492745434
[ConversationRelay-WS] Processing speech transcript: " You are not Audible."
[ConversationRelay-WS] Processing transcript fallback: " You are not Audible."
[ConversationRelay-WS] No ConversationRelay service for call_1756492745434, using basic processing
[ConversationRelay-WS] Calling Azure OpenAI with 5 messages
[ConversationRelay-WS] ===== SENDING AI RESPONSE =====
[ConversationRelay-WS] CallSid: call_1756492745434
[ConversationRelay-WS] Response text: "I'm experiencing some technical difficulties. How else can I help you?"
[ConversationRelay-WS] Azure OpenAI API error: 400 {"error":{"message":"The response was filtered due to the prompt triggering Azure OpenAI's content management policy. Please modify your prompt and retry. To learn more about our content filtering policies please read our documentation: https://go.microsoft.com/fwlink/?linkid=2198766","type":null,"param":"prompt","code":"content_filter","status":400,"innererror":{"code":"ResponsibleAIPolicyViolation","content_filter_result":{"hate":{"filtered":true,"severity":"medium"},"jailbreak":{"filtered":false,"detected":false},"self_harm":{"filtered":false,"severity":"safe"},"sexual":{"filtered":false,"severity":"safe"},"violence":{"filtered":false,"severity":"safe"}}}}}
[ConversationRelay-WS] WebSocket state: 1
[ConversationRelay-WS] Session active: true
[ConversationRelay-WS] Added to conversation history. Total messages: 4
[ConversationRelay-WS] üì§ Sending text message to call_1756492745434: "I'm experiencing some technical difficulties. How else can I help you?"
[ConversationRelay-WS] üì§ Sending text message with ElevenLabs voice config
[ConversationRelay-WS] üìã Full message being sent: {
  "type": "text",
  "text": "I'm experiencing some technical difficulties. How else can I help you?",
  "voice": {
    "name": "21m00Tcm4TlvDq8ikWAM",
    "language": "en-US"
  }
}
[ConversationRelay-WS] üîÑ Attempting to send message via WebSocket
[ConversationRelay-WS] WebSocket state: 1 (1=OPEN, 2=CLOSING, 3=CLOSED)
[ConversationRelay-WS] üì° Sending to Twilio ConversationRelay: {"type":"text","text":"I'm experiencing some technical difficulties. How else can I help you?","voice":{"name":"21m00Tcm4TlvDq8ikWAM","language":"en-US"}}
[ConversationRelay-WS] ‚úÖ Message sent successfully to ConversationRelay
[ConversationRelay-WS] ‚úÖ Text message sent successfully to call_1756492745434
[ConversationRelay-WS] ‚úÖ AI response sent successfully to call_1756492745434
[ConversationRelay-WS] Response preview: "I'm experiencing some technical difficulties. How else can I help you?..."
[ConversationRelay-WS] üèì Sent ping to keep connection alive for call_1756492745434
[ConversationRelay-WS] üèì Received pong from call_1756492745434 - connection alive
[ConversationRelay-WS] üîå Connection closed for CallSid=call_1756492745434, Code=1000, Reason=Closing websocket session
[ConversationRelay-WS] Session duration: 40261ms, State: waiting_for_speech
[ConversationRelay-WS] üõë Cleared silence timeout for closed session call_1756492745434
[Call Status Optimized] Call CA79589809a8e7974591354ac6e76f8ff0 status: completed, tracking: call_1756492737521_uh9pp9y1g
[PerformanceOrchestrator] Stopping optimized conversation for call CA79589809a8e7